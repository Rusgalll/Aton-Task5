## Инфраструктура

- Облачная сеть (Virtual Private Cloud) — сеть, в которой запущена виртуальная машина
- Группа безопасности (VPC Security Group) — ограничение трафика к виртуальной машине. Разрешён весь исходящий трафик, а входящий разрешён только на порты 22 (SSH) и порт сервиса gateway (HTTP)
- Виртуальная машина (Compute Cloud) — на ней запускается потенциальное приложение*
- S3-бакет в Object Storage
- Файл Terraform state  хранится в бакете S3

## Файлы конфигурации
**provider.tf**  
Cодержит настройки провайдера Yandex Cloud и бэкенда для хранения состояния Terraform

- backend "s3" - настройки хранилища состояния Terraform
- provider "yandex" - аутентификация с помощью сервисного аккаунта

**variables.tf**  
Определяет все переменные, используемые в конфигурации (некоторые переменные передаются из GitHub )

- cloud_id, folder_id - идентификаторы облака и каталога в Yandex Cloud
- ssh_key - SSH-ключ для доступа к ВМ
- Параметры виртуальной машины (ядро, память, диск)
- Настройки сети (VPC, подсети)

**vm.tf**  
Создает виртуальную машину с предустановленным Docker

- Использует образ Ubuntu 20.04 LTS
- Применяет cloud-init конфигурацию из vm-install.yml
- Настраивает NAT для доступа из интернета
- Добавляет SSH-ключ для пользователя user


**vpc.tf**  
Создает сетевую инфраструктуру:

- Виртуальную облачную сеть (VPC)
- Подсети в трех зонах доступности
- Группы безопасности

**vm-install.yml**  
Cloud-init конфигурация для первоначальной настройки ВМ:

- Устанавливает Docker и Docker Compose
- Настраивает пользователя user с SSH-доступом
- Автоматически выполняет подготовку системы

## Описание workflow

| Шаг                                           | Описание                                                                                          |
|-----------------------------------------------|---------------------------------------------------------------------------------------------------|
| **Checkout code**                             | Получение кода из репозитория (использует `actions/checkout@v2`)                                   |
| **Setup Terraform**                           | Установка Terraform версии 1.8.3 (использует `hashicorp/setup-terraform@v2`)                      |
| **Set up Yandex Cloud service account key**   | Создание файла авторизации для Yandex Cloud из `secrets`                                           |
| **Initialize Terraform**                      | Инициализация Terraform с настройками бэкенда                                                     |
| **Terraform Plan**                            | Выполнение `terraform plan` (если выбрано действие `plan`)                                         |
| **Terraform Apply**                           | Выполнение `terraform apply -auto-approve` (если выбрано действие `apply`)                        |
| **Terraform Destroy**                         | Выполнение `terraform destroy -auto-approve` (если выбрано действие `destroy`)                    |